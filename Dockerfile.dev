FROM node:20-alpine

# Create app dir
WORKDIR /usr/src/app

# Install build/runtime deps (minimal)
RUN apt-get update && apt-get install -y --no-install-recommends \
  ca-certificates \
  git \
  && rm -rf /var/lib/apt/lists/*

# Copy package files first for better caching
COPY package.json package-lock.json* ./

# Install all dependencies (includes dev deps required for vite)
RUN npm ci --silent

# Copy app source
COPY . .

# Expose Vite port
EXPOSE 3024

# Use environment friendly for file watchers when mounting host volumes
ENV CHOKIDAR_USEPOLLING=true
ENV NODE_ENV=development

# Start the Vite dev server (script "server" in package.json)
CMD ["npm", "run", "server"]


# BUILD DEV (for reference, not used in dev)
# docker build -t easyedit-web:dev -f Dockerfile.dev .
# RUN (for reference, not used in dev)
# docker run --rm -p 3024:3024 easyedit-web:dev
# or to run in background (detached)
# docker run -d --name EASYEDIT -p 3024:3024 easyedit-web:dev
# To stop
# docker stop EASYEDIT
# To remove (only if not started with --rm)
# docker rm EASYEDIT